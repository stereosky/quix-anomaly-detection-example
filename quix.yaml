# Quix Project Descriptor
# This file describes the data pipeline and configuration of resources of a Quix Project.

metadata:
  version: 1.0

# This section describes the Deployments of the data pipeline
deployments:
  - name: influxdb_raw_sink
    application: influxdb_raw_sink
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 800
      replicas: 1
    variables:
      - name: input
        inputType: InputTopic
        required: false
        value: rawdata
      - name: INFLUXDB_TOKEN
        inputType: Secret
        required: false
        secretKey: INFLUXDB_TOKEN
      - name: INFLUXDB_HOST
        inputType: FreeText
        required: false
        value: https://us-east-1-1.aws.cloud2.influxdata.com
      - name: INFLUXDB_ORG
        inputType: FreeText
        required: false
        value: DevRel
      - name: INFLUXDB_MEASUREMENT_NAME
        inputType: FreeText
        required: false
        value: machine_data
      - name: INFLUXDB_DATABASE
        inputType: FreeText
        required: false
        value: quix
      - name: INFLUXDB_TAG_KEYS
        inputType: FreeText
        required: false
        value: ''
      - name: INFLUXDB_FIELD_KEYS
        inputType: FreeText
        required: false
        value: data,qos
      - name: CONSUMER_GROUP_NAME
        inputType: FreeText
        required: false
        value: influxdb-sink
      - name: TIMESTAMP_COLUMN
        inputType: FreeText
        required: false
        value: ''
      - name: BUFFER_SIZE
        inputType: FreeText
        required: false
        value: 1000
      - name: BUFFER_TIMEOUT
        inputType: FreeText
        required: false
        value: 1
  - name: mqtt_source
    application: mqtt_source
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 800
      replicas: 1
    variables:
      - name: output
        inputType: OutputTopic
        required: false
        value: rawdata
      - name: mqtt_topic
        inputType: FreeText
        required: false
        value: machine/quix
      - name: mqtt_server
        inputType: FreeText
        required: false
        value: broker.hivemq.com
      - name: mqtt_port
        inputType: FreeText
        required: false
        value: 1883
      - name: mqtt_username
        inputType: FreeText
        required: false
        value: ''
      - name: mqtt_password
        inputType: FreeText
        required: false
        value: ''
      - name: mqtt_version
        inputType: FreeText
        required: false
        value: 3.1.1
  - name: anomaly_detector
    application: anomaly_detector
    version: latest
    deploymentType: Service
    resources:
      cpu: 200
      memory: 800
      replicas: 1
    variables:
      - name: input
        inputType: InputTopic
        required: false
        value: rawdata
      - name: output
        inputType: OutputTopic
        required: false
        value: detection-results
      - name: HUGGING_FACE_MODEL
        inputType: FreeText
        required: false
        value: jayclifford345/vibration-autoencoder
      - name: ANOMALY_THRESHOLD_PC
        inputType: FreeText
        required: false
        value: 60

# This section describes the Topics of the data pipeline
topics:
  - name: rawdata
  - name: detection-results
